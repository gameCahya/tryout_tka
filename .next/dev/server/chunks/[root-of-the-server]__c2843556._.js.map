{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/bangcs/Documents/tryout_tka/app/api/payment/check-status/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const tryoutId = searchParams.get('tryoutId');\n    const userId = searchParams.get('userId');\n\n    if (!tryoutId || !userId) {\n      return NextResponse.json(\n        { error: 'Missing required parameters' },\n        { status: 400 }\n      );\n    }\n\n    // Check if user has unlocked this tryout (success status)\n    const { data: successData, error: successError } = await supabase\n      .from('unlocked_explanations')\n      .select('payment_status, unlocked_at')\n      .eq('user_id', userId)\n      .eq('tryout_id', tryoutId)\n      .eq('payment_status', 'success')\n      .maybeSingle();\n\n    if (successError && successError.code !== 'PGRST116' && successError.code !== '42703') {\n      console.error('Error checking unlock status:', successError);\n      return NextResponse.json(\n        { error: 'Failed to check unlock status' },\n        { status: 500 }\n      );\n    }\n\n    const hasAccess = successData?.payment_status === 'success' && successData.unlocked_at !== null;\n\n    // Check for pending payment\n    const { data: pendingData, error: pendingError } = await supabase\n      .from('unlocked_explanations')\n      .select('payment_status, payment_url, merchant_order_id')\n      .eq('user_id', userId)\n      .eq('tryout_id', tryoutId)\n      .eq('payment_status', 'pending')\n      .maybeSingle();\n\n    if (pendingError && pendingError.code !== 'PGRST116' && pendingError.code !== '42703') {\n      console.error('Error checking pending payment:', pendingError);\n    }\n\n    const pendingPaymentUrl = pendingData?.payment_status === 'pending' ? pendingData.payment_url : null;\n    const pendingMerchantOrderId = pendingData?.payment_status === 'pending' ? pendingData.merchant_order_id : null;\n\n    return NextResponse.json({\n      hasAccess,\n      pendingPaymentUrl,\n      pendingMerchantOrderId,\n    });\n  } catch (error) {\n    console.error('Error checking payment status:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,mRAAY;AAKtB,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,IAAI,CAAC,YAAY,CAAC,QAAQ;YACxB,OAAO,iTAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,0DAA0D;QAC1D,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,yBACL,MAAM,CAAC,+BACP,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,aAAa,UAChB,EAAE,CAAC,kBAAkB,WACrB,WAAW;QAEd,IAAI,gBAAgB,aAAa,IAAI,KAAK,cAAc,aAAa,IAAI,KAAK,SAAS;YACrF,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,OAAO,iTAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,aAAa,mBAAmB,aAAa,YAAY,WAAW,KAAK;QAE3F,4BAA4B;QAC5B,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SACtD,IAAI,CAAC,yBACL,MAAM,CAAC,kDACP,EAAE,CAAC,WAAW,QACd,EAAE,CAAC,aAAa,UAChB,EAAE,CAAC,kBAAkB,WACrB,WAAW;QAEd,IAAI,gBAAgB,aAAa,IAAI,KAAK,cAAc,aAAa,IAAI,KAAK,SAAS;YACrF,QAAQ,KAAK,CAAC,mCAAmC;QACnD;QAEA,MAAM,oBAAoB,aAAa,mBAAmB,YAAY,YAAY,WAAW,GAAG;QAChG,MAAM,yBAAyB,aAAa,mBAAmB,YAAY,YAAY,iBAAiB,GAAG;QAE3G,OAAO,iTAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,iTAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}