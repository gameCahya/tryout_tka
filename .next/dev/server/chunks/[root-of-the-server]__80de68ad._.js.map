{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/bangcs/Documents/tryout_tka/lib/fonnte.ts"],"sourcesContent":["// lib/fonnte.ts\n// Konfigurasi untuk integrasi Fonnte API\n\ninterface SendWAOptions {\n  target: string;\n  message: string;\n  schedule?: string; // format: 'YYYY-MM-DD HH:mm:ss'\n  country_code?: string;\n  device_id?: string;\n  photo_url?: string;\n  document_url?: string;\n  type?: 'chat' | 'image' | 'document';\n}\n\nexport class Fonnte {\n  private static readonly API_URL = 'https://api.fonnte.com/send';\n  private static readonly API_KEY = process.env.FONNTE_API_KEY;\n\n  static async sendWA(options: SendWAOptions): Promise<{ success: boolean; data?: any; error?: string }> {\n    if (!this.API_KEY) {\n      return {\n        success: false,\n        error: 'FONNTE_API_KEY tidak ditemukan di environment variables'\n      };\n    }\n\n    try {\n      const response = await fetch(this.API_URL, {\n        method: 'POST',\n        headers: {\n          'Authorization': this.API_KEY,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          target: options.target,\n          message: options.message,\n          schedule: options.schedule,\n          country_code: options.country_code || '62',\n          device_id: options.device_id,\n          photo_url: options.photo_url,\n          document_url: options.document_url,\n          type: options.type,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: data.message || 'Gagal mengirim pesan WhatsApp',\n          data\n        };\n      }\n\n      return {\n        success: true,\n        data\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message || 'Terjadi kesalahan saat mengirim pesan WhatsApp'\n      };\n    }\n  }\n}"],"names":[],"mappings":"AAAA,gBAAgB;AAChB,yCAAyC;;;;;AAalC,MAAM;IACX,OAAwB,UAAU,8BAA8B;IAChE,OAAwB,UAAU,QAAQ,GAAG,CAAC,cAAc,CAAC;IAE7D,aAAa,OAAO,OAAsB,EAA6D;QACrG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,IAAI,CAAC,OAAO,EAAE;gBACzC,QAAQ;gBACR,SAAS;oBACP,iBAAiB,IAAI,CAAC,OAAO;oBAC7B,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB,QAAQ,QAAQ,MAAM;oBACtB,SAAS,QAAQ,OAAO;oBACxB,UAAU,QAAQ,QAAQ;oBAC1B,cAAc,QAAQ,YAAY,IAAI;oBACtC,WAAW,QAAQ,SAAS;oBAC5B,WAAW,QAAQ,SAAS;oBAC5B,cAAc,QAAQ,YAAY;oBAClC,MAAM,QAAQ,IAAI;gBACpB;YACF;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,OAAO;oBACL,SAAS;oBACT,OAAO,KAAK,OAAO,IAAI;oBACvB;gBACF;YACF;YAEA,OAAO;gBACL,SAAS;gBACT;YACF;QACF,EAAE,OAAO,OAAY;YACnB,OAAO;gBACL,SAAS;gBACT,OAAO,MAAM,OAAO,IAAI;YAC1B;QACF;IACF;AACF","debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/bangcs/Documents/tryout_tka/app/api/send-wa/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { Fonnte } from '@/lib/fonnte';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { phone, fullName, isNotification, registrationData } = body;\n\n    let targetPhone = phone;\n    \n    if (isNotification) {\n      // Jika ini notifikasi untuk admin, gunakan nomor dari environment variable\n      const adminPhone = process.env.ADMIN_PHONE;\n      if (!adminPhone) {\n        return NextResponse.json(\n          { error: 'ADMIN_PHONE tidak ditemukan di environment variables' },\n          { status: 500 }\n        );\n      }\n      targetPhone = adminPhone;\n    } else if (!targetPhone) {\n      // Jika bukan notifikasi dan tidak ada nomor yang ditentukan\n      return NextResponse.json(\n        { error: 'Phone wajib diisi' },\n        { status: 400 }\n      );\n    }\n\n    // Pastikan format nomor sesuai (62xxx tanpa +)\n    let formattedPhone = targetPhone.replace(/\\D/g, '');\n    if (formattedPhone.startsWith('0')) {\n      formattedPhone = '62' + formattedPhone.substring(1);\n    } else if (!formattedPhone.startsWith('62')) {\n      formattedPhone = '62' + formattedPhone;\n    }\n\n    let message = '';\n    \n    if (isNotification && registrationData) {\n      // Pesan notifikasi untuk admin\n      const { fullName: registrantName, phone: registrantPhone, school: registrantSchool } = registrationData;\n      message = `ðŸ”” NOTIFIKASI PENDAFTARAN BARU ðŸ””\n\nNama: ${registrantName}\nNomor HP: ${registrantPhone}\nAsal Sekolah: ${registrantSchool}\n\nSeseorang telah mendaftar di platform Anda!`;\n    } else {\n      // Pesan selamat datang untuk user\n      message = `Halo ${fullName}! ðŸ‘‹\n\nSelamat datang di platform Try Out kami! ðŸŽ“\n\nTerima kasih telah mendaftar. Akun Anda telah berhasil dibuat dan siap digunakan.\n\nSilakan login untuk mulai mengikuti try out dan meningkatkan kemampuan Anda.\n\nSemangat belajar! ðŸ’ª`;\n    }\n\n    // Kirim ke Fonnte API menggunakan kelas Fonnte\n    const result = await Fonnte.sendWA({\n      target: formattedPhone,\n      message: message,\n      country_code: '62',\n    });\n\n    if (!result.success) {\n      console.error('Fonnte API Error:', result.error, result.data);\n      return NextResponse.json(\n        { error: 'Gagal mengirim WhatsApp', details: result.error },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ \n      success: true, \n      message: 'WhatsApp berhasil dikirim',\n      data: result.data \n    });\n\n  } catch (error: any) {\n    console.error('Error sending WA:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error.message },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,cAAc,EAAE,gBAAgB,EAAE,GAAG;QAE9D,IAAI,cAAc;QAElB,IAAI,gBAAgB;YAClB,2EAA2E;YAC3E,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW;YAC1C,IAAI,CAAC,YAAY;gBACf,OAAO,iTAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAuD,GAChE;oBAAE,QAAQ;gBAAI;YAElB;YACA,cAAc;QAChB,OAAO,IAAI,CAAC,aAAa;YACvB,4DAA4D;YAC5D,OAAO,iTAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,+CAA+C;QAC/C,IAAI,iBAAiB,YAAY,OAAO,CAAC,OAAO;QAChD,IAAI,eAAe,UAAU,CAAC,MAAM;YAClC,iBAAiB,OAAO,eAAe,SAAS,CAAC;QACnD,OAAO,IAAI,CAAC,eAAe,UAAU,CAAC,OAAO;YAC3C,iBAAiB,OAAO;QAC1B;QAEA,IAAI,UAAU;QAEd,IAAI,kBAAkB,kBAAkB;YACtC,+BAA+B;YAC/B,MAAM,EAAE,UAAU,cAAc,EAAE,OAAO,eAAe,EAAE,QAAQ,gBAAgB,EAAE,GAAG;YACvF,UAAU,CAAC;;MAEX,EAAE,eAAe;UACb,EAAE,gBAAgB;cACd,EAAE,iBAAiB;;2CAEU,CAAC;QACxC,OAAO;YACL,kCAAkC;YAClC,UAAU,CAAC,KAAK,EAAE,SAAS;;;;;;;;oBAQb,CAAC;QACjB;QAEA,+CAA+C;QAC/C,MAAM,SAAS,MAAM,yHAAM,CAAC,MAAM,CAAC;YACjC,QAAQ;YACR,SAAS;YACT,cAAc;QAChB;QAEA,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,QAAQ,KAAK,CAAC,qBAAqB,OAAO,KAAK,EAAE,OAAO,IAAI;YAC5D,OAAO,iTAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA2B,SAAS,OAAO,KAAK;YAAC,GAC1D;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,iTAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM,OAAO,IAAI;QACnB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,iTAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,MAAM,OAAO;QAAC,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}